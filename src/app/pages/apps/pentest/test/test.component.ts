import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators } from '@angular/forms';
import { NgbModal } from '@ng-bootstrap/ng-bootstrap';
import { Backend } from 'src/app/core/models/pentest.models';
import { ApiRequestService } from 'src/app/core/service/api-request.service';
import { BreadcrumbItem } from 'src/app/shared/page-title/page-title.model';

@Component({
  selector: 'app-test',
  templateUrl: './test.component.html',
  styleUrls: ['./test.component.scss']
})
export class TestComponent implements OnInit {

  pageTitle: BreadcrumbItem[] = [];
  test: string = "";
  validationGroup1!: FormGroup;

  loading:boolean = false;
  data:boolean = false;

  colunas: any[] = [];
  atributos: any[] = [];


  constructor(
    private modalService: NgbModal,
    public fb: FormBuilder, 
    private apiRequest: ApiRequestService, 
  ) { }

  ngOnInit(): void {
    this.pageTitle = [{ label: 'Pentest', path: '/' }, { label: 'Testes', path: '/', active: true }];
    this.initForm()
  }

  initForm(){
    this.validationGroup1 = this.fb.group({
      escopo: ['', Validators.required],
      domain: ['', Validators.required],
    });
  }

  get form1() { return this.validationGroup1.controls; }

  filtrar(arg: string): void {
    console.log(arg);
  }

  searchData(arg: any): void {
    console.log(arg);
  }

  openModal(content: any) {
    this.loading = false;
    this.data = false;
    this.modalService.open(content, { size: 'lg' });
  }

  onSubmit() {
    this.data=true;
    this.modalService.dismissAll();
    const forms = this.validationGroup1.value;
    this.apiRequest.post("pentest", forms).subscribe(res => {
      this.modalService.dismissAll();
      let resposta = JSON.parse(JSON.stringify(res));
      console.log(resposta.data);
      this.test = JSON.stringify(resposta.data);
      this.loading = true;
      this.data = false
    })
  }

  

}
